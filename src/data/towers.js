// Tower definitions are data-driven. Each tower has:
// - base stats
// - on-hit effects (status effects)
// - an upgrade list that can branch via requires/excludes

const FX = {
  slow: (magnitude, duration) => ({ type: "slow", magnitude, duration }),
  burn: (dmg, duration, tickEvery = 0.5) => ({ type: "burn", magnitude: dmg, duration, tickEvery, damageType: "fire" }),
  poison: (dmg, duration, tickEvery = 0.5) => ({
    type: "poison",
    magnitude: dmg,
    duration,
    tickEvery,
    damageType: "poison",
  }),
  bleed: (dmg, duration, tickEvery = 0.6) => ({
    type: "bleed",
    magnitude: dmg,
    duration,
    tickEvery,
    damageType: "physical",
  }),
  stun: (duration) => ({ type: "stun", magnitude: 1, duration }),
  armorFlat: (amount, duration) => ({ type: "armor_reduction", magnitude: amount, duration, mode: "flat" }),
  armorPct: (pct, duration) => ({ type: "armor_reduction", magnitude: pct, duration, mode: "percent" }),
  vulnerability: (pct, duration) => ({ type: "vulnerability", magnitude: pct, duration }),
};

export const TOWERS = {
  archer: {
    id: "archer",
    name: "Archer",
    role: "single-target",
    cost: 55,
    color: "#e7ecff",
    stats: {
      range: 150,
      fireRate: 1.2,
      damage: 10,
      damageType: "physical",
      projectileSpeed: 340,
      critChance: 0.08,
      critMult: 2.2,
      targeting: "first",
    },
    upgrades: [
      {
        id: "archer_rapid_string",
        tier: 1,
        name: "Rapid String",
        cost: 55,
        description: "+35% fire rate",
        excludes: ["archer_deadeye"],
        effects: { statsMul: { fireRate: 1.35 } },
      },
      {
        id: "archer_deadeye",
        tier: 1,
        name: "Deadeye Scope",
        cost: 65,
        description: "+30% damage, +20% range, +8% crit chance",
        excludes: ["archer_rapid_string"],
        effects: { statsMul: { damage: 1.3, range: 1.2 }, statsAdd: { critChance: 0.08 } },
      },
      {
        id: "archer_piercing_tips",
        tier: 2,
        name: "Piercing Tips",
        cost: 85,
        description: "Arrows shred armor on hit",
        requires: ["archer_deadeye"],
        effects: { addOnHitEffects: [FX.armorFlat(3, 3.5)] },
      },
      {
        id: "archer_barrage",
        tier: 2,
        name: "Barrage",
        cost: 80,
        description: "+25% fire rate, -10% damage",
        requires: ["archer_rapid_string"],
        effects: { statsMul: { fireRate: 1.25, damage: 0.9 } },
      },
      {
        id: "archer_stunning_shot",
        tier: 3,
        name: "Stunning Shot",
        cost: 120,
        description: "Occasional stuns via upgraded arrows",
        requires: ["archer_piercing_tips"],
        effects: { addOnHitEffects: [FX.stun(0.5)] },
      },
      {
        id: "archer_marks",
        tier: 3,
        name: "Marked Targets",
        cost: 130,
        description: "Targets take increased damage (vulnerability)",
        requires: ["archer_barrage"],
        effects: { addOnHitEffects: [FX.vulnerability(0.18, 2.8)] },
      },
    ],
  },

  cannon: {
    id: "cannon",
    name: "Cannon",
    role: "splash",
    cost: 75,
    color: "#a3a3a3",
    stats: {
      range: 130,
      fireRate: 0.75,
      damage: 16,
      damageType: "physical",
      projectileSpeed: 240,
      splashRadius: 46,
      targeting: "first",
    },
    upgrades: [
      {
        id: "cannon_frag",
        tier: 1,
        name: "Fragmentation",
        cost: 70,
        description: "+30% splash radius",
        excludes: ["cannon_mortar"],
        effects: { statsMul: { splashRadius: 1.3 } },
      },
      {
        id: "cannon_mortar",
        tier: 1,
        name: "Mortar Barrel",
        cost: 85,
        description: "+25% range, +25% damage, -15% fire rate",
        excludes: ["cannon_frag"],
        effects: { statsMul: { range: 1.25, damage: 1.25, fireRate: 0.85 } },
      },
      {
        id: "cannon_incendiary",
        tier: 2,
        name: "Incendiary Shells",
        cost: 95,
        description: "Applies burn on hit",
        requires: ["cannon_frag"],
        effects: { addOnHitEffects: [FX.burn(2, 3.0, 0.5)] },
      },
      {
        id: "cannon_concussive",
        tier: 2,
        name: "Concussive Blast",
        cost: 110,
        description: "Splash can briefly stun",
        requires: ["cannon_mortar"],
        effects: { addOnHitEffects: [FX.stun(0.35)] },
      },
      {
        id: "cannon_devastator",
        tier: 3,
        name: "Devastator Shells",
        cost: 150,
        description: "Massive splash and bonus damage",
        requires: ["cannon_incendiary"],
        effects: { statsMul: { splashRadius: 1.25, damage: 1.25 } },
      },
      {
        id: "cannon_siege",
        tier: 3,
        name: "Siege Charge",
        cost: 160,
        description: "Bigger blasts with extra armor shred",
        requires: ["cannon_concussive"],
        effects: { statsMul: { splashRadius: 1.2 }, addOnHitEffects: [FX.armorFlat(4, 3.5)] },
      },
    ],
  },

  frost: {
    id: "frost",
    name: "Frost Spire",
    role: "slowing",
    cost: 70,
    color: "#60a5fa",
    stats: {
      range: 125,
      fireRate: 0.95,
      damage: 6,
      damageType: "ice",
      projectileSpeed: 260,
      targeting: "first",
      onHitEffects: [FX.slow(0.35, 2.2)],
    },
    upgrades: [
      {
        id: "frost_hail",
        tier: 1,
        name: "Hail Shards",
        cost: 80,
        description: "Shots gain splash (slow applies in AoE)",
        excludes: ["frost_deep_freeze"],
        effects: { statsAdd: { splashRadius: 36 } },
      },
      {
        id: "frost_deep_freeze",
        tier: 1,
        name: "Deep Freeze",
        cost: 90,
        description: "Stronger slow, longer duration",
        excludes: ["frost_hail"],
        effects: { addOnHitEffects: [FX.slow(0.18, 3.2)] },
      },
      {
        id: "frost_shatter",
        tier: 2,
        name: "Shatter",
        cost: 120,
        description: "Frozen targets take extra physical damage (via armor shred)",
        requires: ["frost_deep_freeze"],
        effects: { addOnHitEffects: [FX.armorPct(0.22, 2.2)] },
      },
      {
        id: "frost_glacial",
        tier: 2,
        name: "Glacial Core",
        cost: 120,
        description: "+20% range, +15% fire rate",
        requires: ["frost_hail"],
        effects: { statsMul: { range: 1.2, fireRate: 1.15 } },
      },
      {
        id: "frost_cryostasis",
        tier: 3,
        name: "Cryostasis",
        cost: 150,
        description: "Occasional freeze stun on slowed enemies",
        requires: ["frost_shatter"],
        effects: { addOnHitEffects: [FX.stun(0.45)] },
      },
    ],
  },

  alchemist: {
    id: "alchemist",
    name: "Alchemist",
    role: "debuff",
    cost: 80,
    color: "#34d399",
    stats: {
      range: 140,
      fireRate: 0.85,
      damage: 4,
      damageType: "arcane",
      projectileSpeed: 260,
      targeting: "strongest",
      onHitEffects: [FX.armorFlat(3, 3.5), FX.poison(2, 3.5, 0.5)],
    },
    upgrades: [
      {
        id: "alc_corrosion",
        tier: 1,
        name: "Corrosion",
        cost: 95,
        description: "Armor reduction becomes percent-based",
        excludes: ["alc_toxicology"],
        effects: { addOnHitEffects: [FX.armorPct(0.28, 3.0)] },
      },
      {
        id: "alc_toxicology",
        tier: 1,
        name: "Toxicology",
        cost: 90,
        description: "+60% poison damage",
        excludes: ["alc_corrosion"],
        effects: { addOnHitEffects: [FX.poison(1.2, 3.5, 0.5)] },
      },
      {
        id: "alc_spill",
        tier: 2,
        name: "Volatile Spill",
        cost: 120,
        description: "Potion splashes (effects apply in AoE)",
        requires: ["alc_toxicology"],
        effects: { statsAdd: { splashRadius: 30 } },
      },
      {
        id: "alc_brittle",
        tier: 2,
        name: "Brittle Mixture",
        cost: 130,
        description: "+25% range, enemies take more damage (via stronger armor shred)",
        requires: ["alc_corrosion"],
        effects: { statsMul: { range: 1.25 }, addOnHitEffects: [FX.armorPct(0.18, 3.0)] },
      },
      {
        id: "alc_catalyst",
        tier: 3,
        name: "Catalyst",
        cost: 160,
        description: "Adds vulnerability debuff",
        requires: ["alc_spill"],
        effects: { addOnHitEffects: [FX.vulnerability(0.2, 3.0)] },
      },
    ],
  },

  banner: {
    id: "banner",
    name: "Banner",
    role: "support",
    cost: 95,
    color: "#a78bfa",
    stats: {
      aura: {
        radius: 150,
        buffs: { damageMul: 1.12 },
      },
    },
    upgrades: [
      {
        id: "banner_drums",
        tier: 1,
        name: "War Drums",
        cost: 90,
        description: "Aura also buffs fire rate",
        excludes: ["banner_sharpen"],
        effects: { auraAdd: { buffs: { fireRateMul: 1.12 } } },
      },
      {
        id: "banner_sharpen",
        tier: 1,
        name: "Sharpening",
        cost: 95,
        description: "Stronger damage aura",
        excludes: ["banner_drums"],
        effects: { auraAdd: { buffs: { damageMul: 1.18 } } },
      },
      {
        id: "banner_command",
        tier: 2,
        name: "Command",
        cost: 140,
        description: "Aura radius +20% and minor range buff",
        requires: ["banner_drums"],
        effects: { auraAdd: { radius: 180, buffs: { rangeMul: 1.08 } } },
      },
      {
        id: "banner_battle_cry",
        tier: 2,
        name: "Battle Cry",
        cost: 150,
        description: "Aura radius +20% and more damage",
        requires: ["banner_sharpen"],
        effects: { auraAdd: { radius: 180, buffs: { damageMul: 1.24 } } },
      },
      {
        id: "banner_tactician",
        tier: 3,
        name: "Tactician",
        cost: 170,
        description: "Aura adds projectile speed and range",
        requires: ["banner_battle_cry"],
        effects: { auraAdd: { buffs: { projectileSpeedMul: 1.2, rangeMul: 1.1 } } },
      },
    ],
  },

  sniper: {
    id: "sniper",
    name: "Sniper",
    role: "single-target",
    cost: 95,
    color: "#cbd5f5",
    stats: {
      range: 220,
      fireRate: 0.55,
      damage: 32,
      damageType: "physical",
      projectileSpeed: 420,
      critChance: 0.16,
      critMult: 2.6,
      targeting: "strongest",
    },
    upgrades: [
      {
        id: "sniper_stable_scope",
        tier: 1,
        name: "Stable Scope",
        cost: 85,
        description: "+25% range, +10% crit chance",
        excludes: ["sniper_caliber"],
        effects: { statsMul: { range: 1.25 }, statsAdd: { critChance: 0.1 } },
      },
      {
        id: "sniper_caliber",
        tier: 1,
        name: "Caliber Rounds",
        cost: 90,
        description: "+40% damage and armor shred",
        excludes: ["sniper_stable_scope"],
        effects: { statsMul: { damage: 1.4 }, addOnHitEffects: [FX.armorFlat(4, 3.5)] },
      },
      {
        id: "sniper_executioner",
        tier: 2,
        name: "Executioner",
        cost: 140,
        description: "Bonus damage vs elites & bosses",
        requires: ["sniper_caliber"],
        effects: { addBonusTags: ["elite", "boss"], bonusMultAdd: 0.6 },
      },
      {
        id: "sniper_silencer",
        tier: 2,
        name: "Silencer",
        cost: 130,
        description: "Faster fire, targets weakest foes",
        requires: ["sniper_stable_scope"],
        effects: { statsMul: { fireRate: 1.25, damage: 0.9 }, setTargeting: "weakest" },
      },
      {
        id: "sniper_mark",
        tier: 3,
        name: "Marked Shot",
        cost: 170,
        description: "Applies vulnerability on hit",
        requires: ["sniper_executioner"],
        effects: { addOnHitEffects: [FX.vulnerability(0.2, 3.2)] },
      },
      {
        id: "sniper_dead_stop",
        tier: 3,
        name: "Dead Stop",
        cost: 160,
        description: "Shots can briefly stun",
        requires: ["sniper_silencer"],
        effects: { addOnHitEffects: [FX.stun(0.45)] },
      },
    ],
  },
  minigunner: {
    id: "minigunner",
    name: "Minigunner",
    role: "dps",
    cost: 120,
    color: "#f59e0b",
    stats: {
      range: 120,
      fireRate: 6.5,
      damage: 3,
      damageType: "physical",
      projectileSpeed: 320,
      critChance: 0.03,
      critMult: 1.8,
      targeting: "first",
    },
    upgrades: [
      {
        id: "minigunner_rotary",
        tier: 1,
        name: "Rotary Barrel",
        cost: 95,
        description: "Higher rate of fire",
        excludes: ["minigunner_shredder"],
        effects: { statsAdd: { fireRate: 2 } },
      },
      {
        id: "minigunner_shredder",
        tier: 1,
        name: "Shredder Rounds",
        cost: 100,
        description: "Bullets shred armor on hit",
        excludes: ["minigunner_rotary"],
        effects: { addOnHitEffects: [FX.armorFlat(2.5, 2.5)] },
      },
      {
        id: "minigunner_mount",
        tier: 2,
        name: "Stabilized Mount",
        cost: 120,
        description: "More range and steady fire",
        requires: ["minigunner_rotary"],
        effects: { statsAdd: { range: 20, fireRate: 1 } },
      },
      {
        id: "minigunner_tracer",
        tier: 2,
        name: "Tracer Belts",
        cost: 115,
        description: "Higher crit chance",
        requires: ["minigunner_shredder"],
        effects: { statsAdd: { critChance: 0.08 } },
      },
      {
        id: "minigunner_storm",
        tier: 3,
        name: "Bullet Storm",
        cost: 155,
        description: "Huge fire rate and +1 damage",
        requires: ["minigunner_mount"],
        effects: { statsMul: { fireRate: 1.35 }, statsAdd: { damage: 1 } },
      },
      {
        id: "minigunner_melter",
        tier: 3,
        name: "Armor Melter",
        cost: 165,
        description: "Armor shred plus vulnerability",
        requires: ["minigunner_tracer"],
        effects: { addOnHitEffects: [FX.armorFlat(3.5, 3), FX.vulnerability(0.15, 2.5)] },
      },
    ],
  },

  tesla: {
    id: "tesla",
    name: "Tesla Coil",
    role: "splash",
    cost: 90,
    color: "#7dd3fc",
    stats: {
      range: 155,
      fireRate: 1.1,
      damage: 9,
      damageType: "arcane",
      projectileSpeed: 300,
      targeting: "closest",
      chain: { maxJumps: 2, range: 80, falloff: 0.7 },
    },
    upgrades: [
      {
        id: "tesla_overcharge",
        tier: 1,
        name: "Overcharge Coils",
        cost: 80,
        description: "+30% damage",
        excludes: ["tesla_forked"],
        effects: { statsMul: { damage: 1.3 } },
      },
      {
        id: "tesla_forked",
        tier: 1,
        name: "Forked Arc",
        cost: 85,
        description: "+1 chain jump",
        excludes: ["tesla_overcharge"],
        effects: { chainAdd: { maxJumps: 1 } },
      },
      {
        id: "tesla_superconduct",
        tier: 2,
        name: "Superconductors",
        cost: 120,
        description: "Chain range +20% and faster fire",
        requires: ["tesla_overcharge"],
        effects: { chainMul: { range: 1.2 }, statsMul: { fireRate: 1.12 } },
      },
      {
        id: "tesla_static",
        tier: 2,
        name: "Static Field",
        cost: 120,
        description: "Arcs can stun",
        requires: ["tesla_forked"],
        effects: { addOnHitEffects: [FX.stun(0.35)] },
      },
      {
        id: "tesla_storm",
        tier: 3,
        name: "Storm Surge",
        cost: 150,
        description: "+1 jump and slow targets",
        requires: ["tesla_superconduct"],
        effects: { chainAdd: { maxJumps: 1 }, addOnHitEffects: [FX.slow(0.2, 1.4)] },
      },
      {
        id: "tesla_arcstorm",
        tier: 3,
        name: "Arcstorm",
        cost: 155,
        description: "More damage, reduced falloff",
        requires: ["tesla_static"],
        effects: { statsMul: { damage: 1.2 }, chainMul: { falloff: 1.15 } },
      },
    ],
  },

  mortar: {
    id: "mortar",
    name: "Mortar",
    role: "splash",
    cost: 110,
    color: "#fbbf24",
    stats: {
      range: 230,
      fireRate: 0.45,
      damage: 26,
      damageType: "physical",
      projectileSpeed: 220,
      splashRadius: 70,
      targeting: "first",
    },
    upgrades: [
      {
        id: "mortar_high_explosive",
        tier: 1,
        name: "High Explosive",
        cost: 95,
        description: "+25% splash, +20% damage",
        excludes: ["mortar_airburst"],
        effects: { statsMul: { splashRadius: 1.25, damage: 1.2 } },
      },
      {
        id: "mortar_airburst",
        tier: 1,
        name: "Airburst",
        cost: 90,
        description: "+30% fire rate, smaller blast",
        excludes: ["mortar_high_explosive"],
        effects: { statsMul: { fireRate: 1.3, splashRadius: 0.85 } },
      },
      {
        id: "mortar_cluster",
        tier: 2,
        name: "Cluster Rounds",
        cost: 130,
        description: "Explosions ignite foes",
        requires: ["mortar_high_explosive"],
        effects: { addOnHitEffects: [FX.burn(2.5, 3.2, 0.5)] },
      },
      {
        id: "mortar_seismic",
        tier: 2,
        name: "Seismic Shells",
        cost: 130,
        description: "Shockwaves stun and shred armor",
        requires: ["mortar_airburst"],
        effects: { addOnHitEffects: [FX.stun(0.35), FX.armorFlat(3, 3.0)] },
      },
      {
        id: "mortar_inferno",
        tier: 3,
        name: "Inferno Blast",
        cost: 170,
        description: "Stronger burn and larger splash",
        requires: ["mortar_cluster"],
        effects: { statsMul: { splashRadius: 1.15 }, addOnHitEffects: [FX.burn(1.6, 3.5, 0.4)] },
      },
      {
        id: "mortar_quake",
        tier: 3,
        name: "Quake Rounds",
        cost: 175,
        description: "Bigger blasts with extra damage",
        requires: ["mortar_seismic"],
        effects: { statsMul: { splashRadius: 1.2, damage: 1.15 } },
      },
    ],
  },

  flame: {
    id: "flame",
    name: "Flamethrower",
    role: "splash",
    cost: 85,
    color: "#fb923c",
    stats: {
      range: 90,
      fireRate: 3.0,
      damage: 4,
      damageType: "fire",
      projectileSpeed: 210,
      splashRadius: 18,
      targeting: "closest",
      onHitEffects: [FX.burn(1.8, 2.2, 0.4)],
    },
    upgrades: [
      {
        id: "flame_napalm",
        tier: 1,
        name: "Napalm Gel",
        cost: 80,
        description: "Stronger, longer burns",
        excludes: ["flame_wide_nozzle"],
        effects: { addOnHitEffects: [FX.burn(1.2, 1.6, 0.5)] },
      },
      {
        id: "flame_wide_nozzle",
        tier: 1,
        name: "Wide Nozzle",
        cost: 75,
        description: "Longer range and wider splash",
        excludes: ["flame_napalm"],
        effects: { statsMul: { range: 1.2, splashRadius: 1.3 } },
      },
      {
        id: "flame_pressure",
        tier: 2,
        name: "Pressure Feed",
        cost: 115,
        description: "+25% fire rate",
        requires: ["flame_napalm"],
        effects: { statsMul: { fireRate: 1.25 } },
      },
      {
        id: "flame_flash",
        tier: 2,
        name: "Thermal Shock",
        cost: 110,
        description: "Flames can stun briefly",
        requires: ["flame_wide_nozzle"],
        effects: { addOnHitEffects: [FX.stun(0.25)] },
      },
      {
        id: "flame_wildfire",
        tier: 3,
        name: "Wildfire",
        cost: 150,
        description: "Burns apply vulnerability",
        requires: ["flame_pressure"],
        effects: { addOnHitEffects: [FX.vulnerability(0.15, 2.5)] },
      },
      {
        id: "flame_smoke",
        tier: 3,
        name: "Smoke Veil",
        cost: 145,
        description: "Flames also slow targets",
        requires: ["flame_flash"],
        effects: { addOnHitEffects: [FX.slow(0.2, 1.4)] },
      },
    ],
  },

  hex: {
    id: "hex",
    name: "Hex",
    role: "debuff",
    cost: 90,
    color: "#a855f7",
    stats: {
      range: 150,
      fireRate: 0.85,
      damage: 6,
      damageType: "arcane",
      projectileSpeed: 250,
      targeting: "strongest",
      onHitEffects: [FX.vulnerability(0.2, 3.0)],
    },
    upgrades: [
      {
        id: "hex_malediction",
        tier: 1,
        name: "Malediction",
        cost: 85,
        description: "Longer vulnerability duration",
        excludes: ["hex_mire"],
        effects: { addOnHitEffects: [FX.vulnerability(0.1, 1.8)] },
      },
      {
        id: "hex_mire",
        tier: 1,
        name: "Haunting Mire",
        cost: 80,
        description: "Curses also slow",
        excludes: ["hex_malediction"],
        effects: { addOnHitEffects: [FX.slow(0.25, 2.2)] },
      },
      {
        id: "hex_reverb",
        tier: 2,
        name: "Resonant Curse",
        cost: 120,
        description: "Curses splash to nearby foes",
        requires: ["hex_malediction"],
        effects: { statsAdd: { splashRadius: 28 } },
      },
      {
        id: "hex_twist",
        tier: 2,
        name: "Twisted Sigil",
        cost: 120,
        description: "Adds armor reduction",
        requires: ["hex_mire"],
        effects: { addOnHitEffects: [FX.armorPct(0.2, 3.0)] },
      },
      {
        id: "hex_omen",
        tier: 3,
        name: "Omen",
        cost: 155,
        description: "Bonus damage vs elites & bosses",
        requires: ["hex_reverb"],
        effects: { addBonusTags: ["elite", "boss"], bonusMultAdd: 0.35 },
      },
      {
        id: "hex_eruption",
        tier: 3,
        name: "Hex Eruption",
        cost: 150,
        description: "Curses ignite enemies",
        requires: ["hex_twist"],
        effects: { addOnHitEffects: [FX.burn(1.8, 2.6, 0.5)] },
      },
    ],
  },

  overseer: {
    id: "overseer",
    name: "Overseer",
    role: "support",
    cost: 105,
    color: "#22d3ee",
    stats: {
      aura: {
        radius: 160,
        buffs: { rangeMul: 1.1, projectileSpeedMul: 1.15 },
      },
    },
    upgrades: [
      {
        id: "overseer_signal",
        tier: 1,
        name: "Signal Boost",
        cost: 90,
        description: "Larger aura radius",
        excludes: ["overseer_drill"],
        effects: { auraAdd: { radius: 190 } },
      },
      {
        id: "overseer_drill",
        tier: 1,
        name: "Drill Orders",
        cost: 95,
        description: "Aura adds fire rate",
        excludes: ["overseer_signal"],
        effects: { auraAdd: { buffs: { fireRateMul: 1.1 } } },
      },
      {
        id: "overseer_focus",
        tier: 2,
        name: "Focus Protocol",
        cost: 130,
        description: "Aura also buffs damage",
        requires: ["overseer_signal"],
        effects: { auraAdd: { buffs: { damageMul: 1.12 } } },
      },
      {
        id: "overseer_haste",
        tier: 2,
        name: "Haste Protocol",
        cost: 130,
        description: "Stronger fire rate aura",
        requires: ["overseer_drill"],
        effects: { auraAdd: { buffs: { fireRateMul: 1.18 } } },
      },
      {
        id: "overseer_command",
        tier: 3,
        name: "Command Link",
        cost: 165,
        description: "Big range boost and wider aura",
        requires: ["overseer_focus"],
        effects: { auraAdd: { radius: 220, buffs: { rangeMul: 1.18 } } },
      },
      {
        id: "overseer_overclock",
        tier: 3,
        name: "Overclock",
        cost: 165,
        description: "More damage and projectile speed",
        requires: ["overseer_haste"],
        effects: { auraAdd: { buffs: { damageMul: 1.1, projectileSpeedMul: 1.25 } } },
      },
    ],
  },

  chronomancer: {
    id: "chronomancer",
    name: "Chronomancer",
    role: "slowing",
    cost: 95,
    color: "#93c5fd",
    stats: {
      range: 140,
      fireRate: 0.85,
      damage: 5,
      damageType: "arcane",
      projectileSpeed: 240,
      targeting: "first",
      onHitEffects: [FX.slow(0.22, 2.2)],
      ability: {
        name: "Time Rift",
        type: "nova",
        cooldown: 10,
        radius: 90,
        damage: 8,
        damageType: "arcane",
        effects: [FX.stun(0.4), FX.slow(0.35, 2.2)],
      },
    },
    upgrades: [
      {
        id: "chrono_dilation",
        tier: 1,
        name: "Time Dilation",
        cost: 85,
        description: "Stronger, longer slows",
        excludes: ["chrono_quantum"],
        effects: { addOnHitEffects: [FX.slow(0.35, 2.8)] },
      },
      {
        id: "chrono_quantum",
        tier: 1,
        name: "Quantum Reach",
        cost: 85,
        description: "+20% range and faster projectiles",
        excludes: ["chrono_dilation"],
        effects: { statsMul: { range: 1.2, projectileSpeed: 1.2 } },
      },
      {
        id: "chrono_stasis",
        tier: 2,
        name: "Stasis Field",
        cost: 120,
        description: "Time Rift cools down faster and stuns longer",
        requires: ["chrono_dilation"],
        effects: { abilityAdd: { cooldown: -2, radius: 12 }, addAbilityEffects: [FX.stun(0.25)] },
      },
      {
        id: "chrono_echo",
        tier: 2,
        name: "Phase Echo",
        cost: 115,
        description: "+25% fire rate and stronger Time Rift damage",
        requires: ["chrono_quantum"],
        effects: { statsMul: { fireRate: 1.25 }, abilityAdd: { damage: 4 } },
      },
      {
        id: "chrono_collapse",
        tier: 3,
        name: "Chronal Collapse",
        cost: 170,
        description: "Time Rift applies vulnerability and deals more damage",
        requires: ["chrono_stasis"],
        effects: { abilityAdd: { damage: 6, radius: 10 }, addAbilityEffects: [FX.vulnerability(0.2, 3.0)] },
      },
      {
        id: "chrono_loop",
        tier: 3,
        name: "Paradox Loop",
        cost: 165,
        description: "Time Rift cools down quicker and boosts rate of fire",
        requires: ["chrono_echo"],
        effects: { abilityMul: { cooldown: 0.7 }, statsMul: { fireRate: 1.2 } },
      },
    ],
  },

  stormcaller: {
    id: "stormcaller",
    name: "Stormcaller",
    role: "splash",
    cost: 110,
    color: "#7dd3fc",
    stats: {
      range: 160,
      fireRate: 0.75,
      damage: 9,
      damageType: "lightning",
      projectileSpeed: 280,
      targeting: "closest",
      chain: { maxJumps: 1, range: 70, falloff: 0.8 },
      ability: {
        name: "Lightning Barrage",
        type: "volley",
        cooldown: 8,
        range: 180,
        count: 3,
        damage: 12,
        damageType: "lightning",
        projectileSpeed: 320,
        chain: { maxJumps: 2, range: 90, falloff: 0.7 },
      },
    },
    upgrades: [
      {
        id: "storm_charged",
        tier: 1,
        name: "Charged Core",
        cost: 95,
        description: "+30% damage",
        excludes: ["storm_forked"],
        effects: { statsMul: { damage: 1.3 } },
      },
      {
        id: "storm_forked",
        tier: 1,
        name: "Forked Burst",
        cost: 90,
        description: "Lightning Barrage fires more bolts",
        excludes: ["storm_charged"],
        effects: { abilityAdd: { count: 2 } },
      },
      {
        id: "storm_supercells",
        tier: 2,
        name: "Supercells",
        cost: 130,
        description: "Barrage chains further and hits harder",
        requires: ["storm_charged"],
        effects: { abilityAdd: { damage: 5 }, abilityChainAdd: { maxJumps: 1 } },
      },
      {
        id: "storm_static",
        tier: 2,
        name: "Static Surge",
        cost: 125,
        description: "Barrage can stun briefly",
        requires: ["storm_forked"],
        effects: { addAbilityEffects: [FX.stun(0.3)] },
      },
      {
        id: "storm_tempest",
        tier: 3,
        name: "Tempest Core",
        cost: 175,
        description: "More bolts and slows on barrage hits",
        requires: ["storm_supercells"],
        effects: { abilityAdd: { count: 2 }, addAbilityEffects: [FX.slow(0.2, 1.6)] },
      },
      {
        id: "storm_front",
        tier: 3,
        name: "Stormfront",
        cost: 170,
        description: "Barrage deals heavy damage and arcs farther",
        requires: ["storm_static"],
        effects: { abilityMul: { damage: 1.25 }, abilityChainMul: { range: 1.2 } },
      },
    ],
  },

  geomancer: {
    id: "geomancer",
    name: "Geomancer",
    role: "splash",
    cost: 100,
    color: "#fca5a5",
    stats: {
      range: 130,
      fireRate: 0.7,
      damage: 12,
      damageType: "physical",
      projectileSpeed: 240,
      splashRadius: 34,
      targeting: "first",
      ability: {
        name: "Seismic Pulse",
        type: "nova",
        cooldown: 9,
        radius: 80,
        damage: 10,
        damageType: "physical",
        effects: [FX.armorFlat(3, 3.0), FX.stun(0.25)],
      },
    },
    upgrades: [
      {
        id: "geo_stonefletch",
        tier: 1,
        name: "Stonefletch",
        cost: 90,
        description: "+25% damage",
        excludes: ["geo_reach"],
        effects: { statsMul: { damage: 1.25 } },
      },
      {
        id: "geo_reach",
        tier: 1,
        name: "Earthen Reach",
        cost: 90,
        description: "+20% range and splash radius",
        excludes: ["geo_stonefletch"],
        effects: { statsMul: { range: 1.2, splashRadius: 1.2 } },
      },
      {
        id: "geo_seismic",
        tier: 2,
        name: "Seismic Wave",
        cost: 130,
        description: "Seismic Pulse hits harder and wider",
        requires: ["geo_stonefletch"],
        effects: { abilityAdd: { damage: 6, radius: 16 }, addAbilityEffects: [FX.stun(0.2)] },
      },
      {
        id: "geo_fault",
        tier: 2,
        name: "Fault Lines",
        cost: 125,
        description: "Shots slow and crack armor",
        requires: ["geo_reach"],
        effects: { addOnHitEffects: [FX.slow(0.25, 2.0), FX.armorFlat(2, 2.6)] },
      },
      {
        id: "geo_cataclysm",
        tier: 3,
        name: "Cataclysm",
        cost: 175,
        description: "Massive Seismic Pulse damage",
        requires: ["geo_seismic"],
        effects: { abilityMul: { damage: 1.4 }, abilityAdd: { radius: 18 } },
      },
      {
        id: "geo_prison",
        tier: 3,
        name: "Stone Prison",
        cost: 165,
        description: "Slams apply heavy armor reduction",
        requires: ["geo_fault"],
        effects: { addOnHitEffects: [FX.armorPct(0.25, 3.0)] },
      },
    ],
  },

  railgun: {
    id: "railgun",
    name: "Railgun",
    role: "single-target",
    cost: 150,
    endgame: true,
    color: "#cbd5f5",
    stats: {
      range: 260,
      fireRate: 0.4,
      damage: 60,
      damageType: "physical",
      projectileSpeed: 520,
      critChance: 0.1,
      critMult: 2.6,
      targeting: "strongest",
      ability: {
        name: "Rail Strike",
        type: "volley",
        cooldown: 12,
        range: 280,
        count: 1,
        damage: 110,
        damageType: "physical",
        projectileSpeed: 560,
        bonusTags: ["elite", "boss"],
        bonusMult: 1.4,
      },
    },
    upgrades: [
      {
        id: "rail_velocity",
        tier: 1,
        name: "High Velocity",
        cost: 120,
        description: "+20% damage and range",
        excludes: ["rail_stabilizer"],
        effects: { statsMul: { damage: 1.2, range: 1.2 } },
      },
      {
        id: "rail_stabilizer",
        tier: 1,
        name: "Gyro Stabilizer",
        cost: 115,
        description: "+25% fire rate and crit chance",
        excludes: ["rail_velocity"],
        effects: { statsMul: { fireRate: 1.25 }, statsAdd: { critChance: 0.07 } },
      },
      {
        id: "rail_piercer",
        tier: 2,
        name: "Armor Piercer",
        cost: 160,
        description: "Shots shred armor and hit bosses harder",
        requires: ["rail_velocity"],
        effects: { addOnHitEffects: [FX.armorFlat(5, 4)], addBonusTags: ["elite", "boss"], bonusMultAdd: 0.25 },
      },
      {
        id: "rail_capacitor",
        tier: 2,
        name: "Capacitor",
        cost: 150,
        description: "Higher crit multiplier and stronger Rail Strike",
        requires: ["rail_stabilizer"],
        effects: { statsMul: { critMult: 1.3 }, abilityAdd: { damage: 25 } },
      },
      {
        id: "rail_execution",
        tier: 3,
        name: "Execution Protocol",
        cost: 210,
        description: "Massive Rail Strike damage vs elites/bosses",
        requires: ["rail_piercer"],
        effects: { abilityAdd: { damage: 40 }, bonusMultAdd: 0.4, addBonusTags: ["elite", "boss"] },
      },
      {
        id: "rail_overdrive",
        tier: 3,
        name: "Overdrive Coil",
        cost: 200,
        description: "Faster fire and extra damage",
        requires: ["rail_capacitor"],
        effects: { statsMul: { fireRate: 1.2, damage: 1.1 } },
      },
      {
        id: "rail_orbital",
        tier: 4,
        name: "Orbital Lance",
        cost: 360,
        description: "Rail Strike fires twice and stuns on impact",
        requires: ["rail_execution"],
        effects: { abilityAdd: { count: 1, damage: 80 }, abilityMul: { cooldown: 0.8 }, addAbilityEffects: [FX.stun(0.35)] },
      },
      {
        id: "rail_singularity",
        tier: 4,
        name: "Singularity Coil",
        cost: 340,
        description: "Overdrive salvo gains armor shred and extra damage",
        requires: ["rail_overdrive"],
        effects: { statsMul: { fireRate: 1.18, damage: 1.12 }, abilityAdd: { damage: 45 }, addAbilityEffects: [FX.armorFlat(5, 3)] },
      },
    ],
  },

  rocketpod: {
    id: "rocketpod",
    name: "Rocket Pod",
    role: "splash",
    cost: 135,
    endgame: true,
    color: "#f97316",
    stats: {
      range: 180,
      fireRate: 0.65,
      damage: 20,
      damageType: "fire",
      projectileSpeed: 240,
      splashRadius: 58,
      targeting: "first",
      onHitEffects: [FX.burn(2.2, 2.6, 0.5)],
      ability: {
        name: "Salvo",
        type: "volley",
        cooldown: 9,
        range: 200,
        count: 4,
        damage: 16,
        damageType: "fire",
        projectileSpeed: 280,
        splashRadius: 45,
        effects: [FX.burn(1.6, 2.2, 0.5)],
      },
    },
    upgrades: [
      {
        id: "rocket_barrage",
        tier: 1,
        name: "Barrage",
        cost: 120,
        description: "Bigger splash radius",
        excludes: ["rocket_fuel"],
        effects: { statsMul: { splashRadius: 1.25 } },
      },
      {
        id: "rocket_fuel",
        tier: 1,
        name: "High-Octane Fuel",
        cost: 115,
        description: "+25% fire rate",
        excludes: ["rocket_barrage"],
        effects: { statsMul: { fireRate: 1.25 } },
      },
      {
        id: "rocket_napalm",
        tier: 2,
        name: "Napalm Pods",
        cost: 155,
        description: "Stronger burns and vulnerability on hit",
        requires: ["rocket_barrage"],
        effects: { addOnHitEffects: [FX.burn(1.8, 2.8, 0.5), FX.vulnerability(0.12, 2.4)] },
      },
      {
        id: "rocket_cluster",
        tier: 2,
        name: "Cluster Salvo",
        cost: 150,
        description: "Salvo fires more rockets",
        requires: ["rocket_fuel"],
        effects: { abilityAdd: { count: 2 } },
      },
      {
        id: "rocket_inferno",
        tier: 3,
        name: "Inferno Payload",
        cost: 210,
        description: "Salvo hits harder with bigger blasts",
        requires: ["rocket_napalm"],
        effects: { abilityAdd: { damage: 8, splashRadius: 10 } },
      },
      {
        id: "rocket_shock",
        tier: 3,
        name: "Shockwave Pods",
        cost: 200,
        description: "Salvo can stun briefly",
        requires: ["rocket_cluster"],
        effects: { addAbilityEffects: [FX.stun(0.35)] },
      },
      {
        id: "rocket_cataclysm",
        tier: 4,
        name: "Cataclysm Barrage",
        cost: 360,
        description: "Salvo rains extra rockets with devastating burns",
        requires: ["rocket_inferno"],
        effects: {
          abilityAdd: { count: 2, damage: 12, splashRadius: 16 },
          abilityMul: { cooldown: 0.85 },
          addAbilityEffects: [FX.burn(2.4, 3.2, 0.6)],
        },
      },
      {
        id: "rocket_thunder",
        tier: 4,
        name: "Thunder Salvo",
        cost: 350,
        description: "Shock salvos fire more rockets and stun harder",
        requires: ["rocket_shock"],
        effects: { abilityAdd: { count: 3, damage: 8 }, addAbilityEffects: [FX.stun(0.45)], statsMul: { fireRate: 1.1 } },
      },
    ],
  },

  beacon: {
    id: "beacon",
    name: "Beacon",
    role: "support",
    cost: 150,
    endgame: true,
    color: "#22d3ee",
    stats: {
      aura: {
        radius: 190,
        buffs: { damageMul: 1.15, rangeMul: 1.12 },
      },
      ability: {
        name: "Signal Burst",
        type: "nova",
        cooldown: 14,
        radius: 120,
        damage: 8,
        damageType: "arcane",
        effects: [FX.slow(0.25, 2.2), FX.vulnerability(0.15, 2.8)],
      },
    },
    upgrades: [
      {
        id: "beacon_uplink",
        tier: 1,
        name: "Uplink Array",
        cost: 125,
        description: "Aura radius +20%",
        excludes: ["beacon_amplify"],
        effects: { auraAdd: { radius: 230 } },
      },
      {
        id: "beacon_amplify",
        tier: 1,
        name: "Amplified Core",
        cost: 130,
        description: "Stronger damage aura",
        excludes: ["beacon_uplink"],
        effects: { auraAdd: { buffs: { damageMul: 1.22 } } },
      },
      {
        id: "beacon_overclock",
        tier: 2,
        name: "Overclock Grid",
        cost: 170,
        description: "Aura also buffs fire rate",
        requires: ["beacon_uplink"],
        effects: { auraAdd: { buffs: { fireRateMul: 1.12 } } },
      },
      {
        id: "beacon_spotter",
        tier: 2,
        name: "Spotter Network",
        cost: 165,
        description: "Aura adds projectile speed",
        requires: ["beacon_amplify"],
        effects: { auraAdd: { buffs: { projectileSpeedMul: 1.18 } } },
      },
      {
        id: "beacon_command",
        tier: 3,
        name: "Command Net",
        cost: 220,
        description: "Massive aura radius",
        requires: ["beacon_overclock"],
        effects: { auraAdd: { radius: 260, buffs: { rangeMul: 1.18 } } },
      },
      {
        id: "beacon_radiance",
        tier: 3,
        name: "Radiant Storm",
        cost: 210,
        description: "Signal Burst hits harder and faster",
        requires: ["beacon_spotter"],
        effects: { abilityAdd: { damage: 6, radius: 12 }, abilityMul: { cooldown: 0.8 } },
      },
      {
        id: "beacon_skylink",
        tier: 4,
        name: "Skylink Crown",
        cost: 360,
        description: "Massive aura reach and empowered Signal Burst",
        requires: ["beacon_command"],
        effects: { auraAdd: { radius: 300, buffs: { damageMul: 1.12, rangeMul: 1.1 } }, abilityAdd: { damage: 10, radius: 16 } },
      },
      {
        id: "beacon_prism",
        tier: 4,
        name: "Prism Surge",
        cost: 340,
        description: "Burst cooldown plummets and stuns on impact",
        requires: ["beacon_radiance"],
        effects: { abilityMul: { cooldown: 0.65 }, abilityAdd: { damage: 12, radius: 18 }, addAbilityEffects: [FX.stun(0.25)] },
      },
    ],
  },

  citadel: {
    id: "citadel",
    name: "Citadel",
    role: "support",
    cost: 170,
    endgame: true,
    color: "#a78bfa",
    stats: {
      aura: {
        radius: 175,
        buffs: { fireRateMul: 1.15, projectileSpeedMul: 1.15 },
      },
      ability: {
        name: "Shockwave",
        type: "nova",
        cooldown: 16,
        radius: 100,
        damage: 10,
        damageType: "physical",
        effects: [FX.stun(0.35), FX.armorFlat(2, 2.5)],
      },
    },
    upgrades: [
      {
        id: "citadel_bulwark",
        tier: 1,
        name: "Bulwark",
        cost: 140,
        description: "Aura radius +20%",
        excludes: ["citadel_fury"],
        effects: { auraAdd: { radius: 210 } },
      },
      {
        id: "citadel_fury",
        tier: 1,
        name: "War Fury",
        cost: 145,
        description: "Aura also buffs damage",
        excludes: ["citadel_bulwark"],
        effects: { auraAdd: { buffs: { damageMul: 1.12 } } },
      },
      {
        id: "citadel_siege",
        tier: 2,
        name: "Siege Orders",
        cost: 175,
        description: "Stronger damage aura",
        requires: ["citadel_fury"],
        effects: { auraAdd: { buffs: { damageMul: 1.18 } } },
      },
      {
        id: "citadel_accelerant",
        tier: 2,
        name: "Accelerant",
        cost: 170,
        description: "More fire rate in aura",
        requires: ["citadel_bulwark"],
        effects: { auraAdd: { buffs: { fireRateMul: 1.22 } } },
      },
      {
        id: "citadel_bastion",
        tier: 3,
        name: "Bastion",
        cost: 220,
        description: "Huge aura with faster projectiles",
        requires: ["citadel_accelerant"],
        effects: { auraAdd: { radius: 240, buffs: { projectileSpeedMul: 1.3 } } },
      },
      {
        id: "citadel_war_drums",
        tier: 3,
        name: "War Drums",
        cost: 210,
        description: "Shockwave fires more often and hits harder",
        requires: ["citadel_siege"],
        effects: { abilityAdd: { damage: 6, radius: 10 }, abilityMul: { cooldown: 0.7 } },
      },
      {
        id: "citadel_fortress",
        tier: 4,
        name: "Fortress Core",
        cost: 360,
        description: "Massive aura and stronger Shockwaves",
        requires: ["citadel_bastion"],
        effects: { auraAdd: { radius: 280, buffs: { projectileSpeedMul: 1.35, fireRateMul: 1.1 } }, abilityAdd: { damage: 8, radius: 14 } },
      },
      {
        id: "citadel_thunder",
        tier: 4,
        name: "Thunder Drums",
        cost: 350,
        description: "Shockwaves hit harder, faster, and slow enemies",
        requires: ["citadel_war_drums"],
        effects: { abilityMul: { cooldown: 0.6 }, abilityAdd: { damage: 10, radius: 18 }, addAbilityEffects: [FX.slow(0.25, 2.4)] },
      },
    ],
  },
  obliterator: {
    id: "obliterator",
    name: "Obliterator",
    role: "dps",
    cost: 320,
    endgame: true,
    color: "#f97316",
    stats: {
      range: 185,
      fireRate: 0.45,
      damage: 80,
      damageType: "physical",
      projectileSpeed: 360,
      critChance: 0.12,
      critMult: 2.6,
      targeting: "strongest",
    },
    upgrades: [
      {
        id: "obliterator_lensing",
        tier: 1,
        name: "Magnetic Lensing",
        cost: 180,
        description: "+30% damage, +10% range",
        excludes: ["obliterator_overfeed"],
        effects: { statsMul: { damage: 1.3, range: 1.1 } },
      },
      {
        id: "obliterator_overfeed",
        tier: 1,
        name: "Overcharged Feed",
        cost: 170,
        description: "+25% fire rate, -10% damage",
        excludes: ["obliterator_lensing"],
        effects: { statsMul: { fireRate: 1.25, damage: 0.9 } },
      },
      {
        id: "obliterator_annihilator",
        tier: 2,
        name: "Annihilator Rounds",
        cost: 220,
        description: "Bonus damage vs elites/bosses",
        requires: ["obliterator_lensing"],
        effects: { addBonusTags: ["elite", "boss"], bonusMultMul: 1.3 },
      },
      {
        id: "obliterator_burst",
        tier: 2,
        name: "Stabilized Burst",
        cost: 210,
        description: "+15% fire rate, +10% crit chance",
        requires: ["obliterator_overfeed"],
        effects: { statsMul: { fireRate: 1.15 }, statsAdd: { critChance: 0.1 } },
      },
      {
        id: "obliterator_worldsplitter",
        tier: 3,
        name: "Worldsplitter",
        cost: 300,
        description: "Massive damage and higher crit chance",
        requires: ["obliterator_annihilator"],
        effects: { statsMul: { damage: 1.45 }, statsAdd: { critChance: 0.12 } },
      },
      {
        id: "obliterator_rend",
        tier: 3,
        name: "Rend Accelerator",
        cost: 280,
        description: "Much faster fire and stronger crits",
        requires: ["obliterator_burst"],
        effects: { statsMul: { fireRate: 1.35, critMult: 1.2 } },
      },
      {
        id: "obliterator_apex",
        tier: 4,
        name: "Annihilation Array",
        cost: 420,
        description: "Unlocks a brutal Annihilation Volley",
        requires: ["obliterator_worldsplitter"],
        effects: {
          setAbility: {
            name: "Annihilation Volley",
            type: "volley",
            cooldown: 12,
            range: 220,
            count: 4,
            damage: 110,
            damageType: "physical",
            projectileSpeed: 420,
            bonusTags: ["elite", "boss"],
            bonusMult: 1.5,
            effects: [FX.armorFlat(4, 3)],
          },
        },
      },
      {
        id: "obliterator_rupture",
        tier: 4,
        name: "Rend Cascade",
        cost: 400,
        description: "Unlocks a rapid Rend Cascade volley",
        requires: ["obliterator_rend"],
        effects: {
          setAbility: {
            name: "Rend Cascade",
            type: "volley",
            cooldown: 10,
            range: 210,
            count: 6,
            damage: 75,
            damageType: "physical",
            projectileSpeed: 420,
            effects: [FX.bleed(2.8, 3.8)],
          },
        },
      },
    ],
  },
  sunbreaker: {
    id: "sunbreaker",
    name: "Sunbreaker",
    role: "dps",
    cost: 300,
    endgame: true,
    color: "#facc15",
    stats: {
      range: 150,
      fireRate: 0.38,
      damage: 90,
      damageType: "fire",
      projectileSpeed: 240,
      splashRadius: 64,
      critChance: 0.05,
      critMult: 2.1,
      targeting: "first",
    },
    upgrades: [
      {
        id: "sunbreaker_compression",
        tier: 1,
        name: "Solar Compression",
        cost: 175,
        description: "+25% damage, +10 splash radius",
        excludes: ["sunbreaker_cycler"],
        effects: { statsMul: { damage: 1.25 }, statsAdd: { splashRadius: 10 } },
      },
      {
        id: "sunbreaker_cycler",
        tier: 1,
        name: "Ignition Cycler",
        cost: 165,
        description: "+30% fire rate, -10% damage",
        excludes: ["sunbreaker_compression"],
        effects: { statsMul: { fireRate: 1.3, damage: 0.9 } },
      },
      {
        id: "sunbreaker_starforged",
        tier: 2,
        name: "Starforged Shells",
        cost: 210,
        description: "+20% damage, +15% projectile speed",
        requires: ["sunbreaker_compression"],
        effects: { statsMul: { damage: 1.2, projectileSpeed: 1.15 } },
      },
      {
        id: "sunbreaker_detonators",
        tier: 2,
        name: "Twin Detonators",
        cost: 200,
        description: "+40% splash, +10% fire rate",
        requires: ["sunbreaker_cycler"],
        effects: { statsMul: { splashRadius: 1.4, fireRate: 1.1 } },
      },
      {
        id: "sunbreaker_novalance",
        tier: 3,
        name: "Nova Lance",
        cost: 300,
        description: "Massive damage and larger blast radius",
        requires: ["sunbreaker_starforged"],
        effects: { statsMul: { damage: 1.5, splashRadius: 1.25 } },
      },
      {
        id: "sunbreaker_cascade",
        tier: 3,
        name: "Thermal Cascade",
        cost: 285,
        description: "Faster fire with amplified explosions",
        requires: ["sunbreaker_detonators"],
        effects: { statsMul: { fireRate: 1.35, splashRadius: 1.2, damage: 1.15 } },
      },
      {
        id: "sunbreaker_supernova",
        tier: 4,
        name: "Supernova",
        cost: 420,
        description: "Unlocks a devastating solar nova",
        requires: ["sunbreaker_novalance"],
        effects: {
          setAbility: {
            name: "Supernova",
            type: "nova",
            cooldown: 12,
            radius: 130,
            damage: 140,
            damageType: "fire",
            effects: [FX.burn(3.2, 4.2, 0.7), FX.vulnerability(0.2, 3.5)],
          },
        },
      },
      {
        id: "sunbreaker_eruption",
        tier: 4,
        name: "Solar Eruption",
        cost: 400,
        description: "Unlocks a wide solar eruption that slows enemies",
        requires: ["sunbreaker_cascade"],
        effects: {
          setAbility: {
            name: "Solar Eruption",
            type: "nova",
            cooldown: 10,
            radius: 115,
            damage: 110,
            damageType: "fire",
            effects: [FX.burn(2.8, 3.6, 0.6), FX.slow(0.2, 2.4)],
          },
        },
      },
    ],
  },
  beamer: {
    id: "beamer",
    name: "Prism Beam",
    role: "dps",
    cost: 340,
    endgame: true,
    color: "#a78bfa",
    stats: {
      range: 180,
      fireRate: 0,
      damage: 72,
      damageType: "arcane",
      projectileSpeed: 0,
      beam: { width: 3.2, effectInterval: 0.6, warmupDuration: 1.8, warmupMin: 0.35, decayDuration: 1.1 },
      targeting: "strongest",
    },
    upgrades: [
      {
        id: "beamer_focus",
        tier: 1,
        name: "Focusing Array",
        cost: 190,
        description: "+35% damage, +10% range",
        excludes: ["beamer_conduit"],
        effects: { statsMul: { damage: 1.35, range: 1.1 } },
      },
      {
        id: "beamer_conduit",
        tier: 1,
        name: "Stabilized Conduit",
        cost: 180,
        description: "+25% range, +10% damage",
        excludes: ["beamer_focus"],
        effects: { statsMul: { range: 1.25, damage: 1.1 } },
      },
      {
        id: "beamer_disrupt",
        tier: 2,
        name: "Disruption Core",
        cost: 230,
        description: "Beam applies vulnerability",
        requires: ["beamer_focus"],
        effects: { addOnHitEffects: [FX.vulnerability(0.22, 2.5)] },
      },
      {
        id: "beamer_resonance",
        tier: 2,
        name: "Resonant Field",
        cost: 220,
        description: "Bonus damage vs elites/bosses",
        requires: ["beamer_conduit"],
        effects: { addBonusTags: ["elite", "boss"], bonusMultMul: 1.35 },
      },
      {
        id: "beamer_event_horizon",
        tier: 3,
        name: "Event Horizon",
        cost: 310,
        description: "Massive damage and range",
        requires: ["beamer_disrupt"],
        effects: { statsMul: { damage: 1.5, range: 1.15 } },
      },
      {
        id: "beamer_prismatic",
        tier: 3,
        name: "Prismatic Collapse",
        cost: 300,
        description: "Higher damage with extended range",
        requires: ["beamer_resonance"],
        effects: { statsMul: { damage: 1.4, range: 1.2 } },
      },
      {
        id: "beamer_parallax",
        tier: 4,
        name: "Parallax Nova",
        cost: 420,
        description: "Unlocks a Prismatic Nova ability",
        requires: ["beamer_event_horizon"],
        effects: {
          setAbility: {
            name: "Prismatic Nova",
            type: "nova",
            cooldown: 11,
            radius: 120,
            damage: 80,
            damageType: "arcane",
            effects: [FX.vulnerability(0.2, 3.0), FX.slow(0.25, 2.6)],
          },
        },
      },
      {
        id: "beamer_spectrum",
        tier: 4,
        name: "Spectrum Barrage",
        cost: 400,
        description: "Unlocks a rapid Spectrum Barrage volley",
        requires: ["beamer_prismatic"],
        effects: {
          setAbility: {
            name: "Spectrum Barrage",
            type: "volley",
            cooldown: 9,
            range: 200,
            count: 6,
            damage: 45,
            damageType: "arcane",
            projectileSpeed: 340,
            effects: [FX.vulnerability(0.12, 2.2)],
          },
        },
      },
    ],
  },
  summoner: {
    id: "summoner",
    name: "Vanguard Kennel",
    role: "summoner",
    cost: 140,
    color: "#34d399",
    stats: {
      range: 120,
      fireRate: 0,
      damage: 0,
      damageType: "physical",
      projectileSpeed: 240,
      ability: {
        type: "summon",
        name: "Call Vanguard",
        cooldown: 8,
        count: 1,
        radius: 90,
        summon: {
          id: "vanguard",
          name: "Vanguard",
          hp: 60,
          speed: 62,
          range: 110,
          fireRate: 1.1,
          damage: 7,
          damageType: "physical",
          projectileSpeed: 240,
          radius: 8,
          lifetime: 18,
          cap: 3,
        },
      },
    },
    upgrades: [
      {
        id: "summoner_drills",
        tier: 1,
        name: "Veteran Drills",
        cost: 85,
        description: "Summons gain health and damage",
        excludes: ["summoner_muster"],
        effects: { abilityAdd: { summon: { hp: 20, damage: 2, lifetime: 2 } } },
      },
      {
        id: "summoner_muster",
        tier: 1,
        name: "Rapid Muster",
        cost: 80,
        description: "Summon cooldown down, +1 unit",
        excludes: ["summoner_drills"],
        effects: { abilityAdd: { cooldown: -1.2, count: 1 } },
      },
      {
        id: "summoner_guardian",
        tier: 2,
        name: "Guardian Rifles",
        cost: 110,
        description: "Summons gain range and fire rate",
        requires: ["summoner_drills"],
        effects: { abilityAdd: { summon: { range: 25, fireRate: 0.35 } } },
      },
      {
        id: "summoner_squad",
        tier: 2,
        name: "Extra Squad",
        cost: 120,
        description: "+1 summon per call",
        requires: ["summoner_muster"],
        effects: { abilityAdd: { count: 1, summon: { cap: 1 } } },
      },
      {
        id: "summoner_battalion",
        tier: 3,
        name: "Steel Battalion",
        cost: 165,
        description: "Summons gain heavy armor and bleed rounds",
        requires: ["summoner_guardian"],
        effects: { abilityAdd: { summon: { hp: 45, damage: 4, onHitEffects: [FX.bleed(3, 3.5)] } } },
      },
      {
        id: "summoner_march",
        tier: 3,
        name: "Endless March",
        cost: 170,
        description: "Faster calls and larger squads",
        requires: ["summoner_squad"],
        effects: { abilityMul: { cooldown: 0.7 }, abilityAdd: { count: 1, summon: { cap: 1 } } },
      },
    ],
  },
  dronebay: {
    id: "dronebay",
    name: "Drone Bay",
    role: "summoner",
    cost: 155,
    color: "#38bdf8",
    stats: {
      range: 120,
      fireRate: 0,
      damage: 0,
      damageType: "lightning",
      projectileSpeed: 260,
      ability: {
        type: "summon",
        name: "Deploy Drones",
        cooldown: 7.5,
        count: 1,
        radius: 100,
        summon: {
          id: "arc_drone",
          name: "Arc Drone",
          hp: 40,
          speed: 82,
          range: 130,
          fireRate: 1.4,
          damage: 6,
          damageType: "lightning",
          projectileSpeed: 280,
          radius: 7,
          lifetime: 16,
          chain: { maxJumps: 1, range: 70, falloff: 0.8 },
          cap: 4,
        },
      },
    },
    upgrades: [
      {
        id: "dronebay_overclock",
        tier: 1,
        name: "Overclocked Bays",
        cost: 95,
        description: "Summon faster and +1 drone",
        excludes: ["dronebay_voltaic"],
        effects: { abilityAdd: { cooldown: -1.2, count: 1 } },
      },
      {
        id: "dronebay_voltaic",
        tier: 1,
        name: "Voltaic Core",
        cost: 100,
        description: "Drones hit harder and chain farther",
        excludes: ["dronebay_overclock"],
        effects: { abilityAdd: { summon: { damage: 3, chain: { range: 25 } } } },
      },
      {
        id: "dronebay_arcnet",
        tier: 2,
        name: "Arc Net",
        cost: 125,
        description: "Chain jumps +1 and longer range",
        requires: ["dronebay_voltaic"],
        effects: { abilityAdd: { summon: { chain: { maxJumps: 1, range: 20 } } } },
      },
      {
        id: "dronebay_rapid",
        tier: 2,
        name: "Rapid Launch",
        cost: 120,
        description: "Drones fire faster and move quicker",
        requires: ["dronebay_overclock"],
        effects: { abilityAdd: { summon: { fireRate: 0.4, speed: 12 } } },
      },
      {
        id: "dronebay_tempest",
        tier: 3,
        name: "Tempest Swarm",
        cost: 175,
        description: "+1 drone per call with stronger chains",
        requires: ["dronebay_arcnet"],
        effects: { abilityAdd: { count: 1, summon: { chain: { maxJumps: 1, falloff: 0.7 }, cap: 1 } } },
      },
      {
        id: "dronebay_saturation",
        tier: 3,
        name: "Saturation Launch",
        cost: 170,
        description: "Much faster launches and longer drone life",
        requires: ["dronebay_rapid"],
        effects: { abilityMul: { cooldown: 0.7 }, abilityAdd: { summon: { lifetime: 4 } } },
      },
    ],
  },
  marshal: {
    id: "marshal",
    name: "Marshal Post",
    role: "summoner",
    cost: 165,
    color: "#a3e635",
    stats: {
      range: 130,
      fireRate: 0,
      damage: 0,
      damageType: "physical",
      projectileSpeed: 240,
      aura: {
        radius: 120,
        buffs: { damageMul: 1.08, fireRateMul: 1.05 },
      },
      ability: {
        type: "summon",
        name: "Call Squires",
        cooldown: 9,
        count: 1,
        radius: 110,
        summon: {
          id: "squire",
          name: "Squire",
          hp: 52,
          speed: 60,
          range: 110,
          fireRate: 1.1,
          damage: 6,
          damageType: "physical",
          projectileSpeed: 230,
          radius: 8,
          lifetime: 20,
          cap: 3,
        },
      },
    },
    upgrades: [
      {
        id: "marshal_drill",
        tier: 1,
        name: "Drill Sergeants",
        cost: 90,
        description: "Aura stronger and squires tougher",
        excludes: ["marshal_barracks"],
        effects: { auraAdd: { buffs: { damageMul: 1.1, fireRateMul: 1.08 } }, abilityAdd: { summon: { hp: 18, damage: 2 } } },
      },
      {
        id: "marshal_barracks",
        tier: 1,
        name: "Expanded Barracks",
        cost: 95,
        description: "Summon +1 squire",
        excludes: ["marshal_drill"],
        effects: { abilityAdd: { count: 1, summon: { cap: 1 } } },
      },
      {
        id: "marshal_banner",
        tier: 2,
        name: "Battle Standards",
        cost: 120,
        description: "Aura radius increases",
        requires: ["marshal_drill"],
        effects: { auraAdd: { radius: 150 } },
      },
      {
        id: "marshal_sharpen",
        tier: 2,
        name: "Sharpened Blades",
        cost: 125,
        description: "Squires apply bleed on hit",
        requires: ["marshal_barracks"],
        effects: { abilityAdd: { summon: { onHitEffects: [FX.bleed(2.5, 3)] } } },
      },
      {
        id: "marshal_command",
        tier: 3,
        name: "Commanding Presence",
        cost: 170,
        description: "Huge aura and faster calls",
        requires: ["marshal_banner"],
        effects: { auraAdd: { radius: 190 }, abilityMul: { cooldown: 0.75 } },
      },
      {
        id: "marshal_legion",
        tier: 3,
        name: "Legion Surge",
        cost: 175,
        description: "Large squads with sturdier squires",
        requires: ["marshal_sharpen"],
        effects: { abilityAdd: { count: 1, summon: { hp: 25, damage: 2, cap: 1 } } },
      },
    ],
  },
};
